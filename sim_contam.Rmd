Simulated Contaminant Summary
========================================================
## Dataset description:

## Methods summary:

## Results

```{r echo=FALSE, message=FALSE}
#loading required packages and sourcing files
library(ggplot2)
library(stringr)
library(reshape2)
library(plyr)
source("file_locations.R")
```

### Summary of matches
```{r}
sim_matches <- read.csv(str_c(path_results_directory,"/sim_contam_matches.csv", sep=""), stringsAsFactor = F)
```

#### Number of unique Match org hits per combination
```{r}
sim_unique_counts <- ddply(sim_matches, .(org1, org2), summarize, count = length(unique(match_tid)))
ggplot(sim_unique_counts) + geom_bar(aes(x = as.character(org2), y = count), stat = "identity") + facet_wrap(~org1) +
  labs(x = "Contaminant", y = "Number of hits to unique organisms")+
  theme_bw()
```
Observations: between 50 and 200 unique organism hits for each of the dataset combinations.  Will need to compare these values for the full dataset mixtures and the single org datasets. Note that the number of unique matches go to the substrain level.
**A number of -1 for match ids need to look into.**

#### LOD by organism and contaminant
```{r}
sim_LOD <- ddply(.data=sim_matches,
                 .variables=.(size, org1, org2, org2_match), 
                 summarize, LOD = min(prop2))
```
Limit of detection is defined as the proportion of contaminant with the lowest proportion.  The contaminant proportion is representative of the proprotion of the sample and not the proportion of reads.
```{r}
ggplot(sim_LOD[sim_LOD$org2_match == "exact",]) + 
  geom_bar(aes(x = as.character(org2), y = LOD, fill = as.factor(size)), stat = "identity", position = "dodge") + 
  geom_hline(aes(yintercept = c(0.01, 0.0001)), linetype = 2) + 
  facet_grid(~org1, scale = "free_x") + scale_y_log10() +   
  theme_bw() +
  theme(axis.text.x=element_text(angle=-90)) +
  labs(x = "Contaminant", fill = "Read Size (bp)", y = "Limit of Detection", title = "Exact Matches to Contaminat Genome")
```

```{r}
ggplot(sim_LOD[sim_LOD$org2_match == "species",]) + 
  geom_bar(aes(x = as.character(org2), y = LOD, fill = as.factor(size)), stat = "identity", position = "dodge") + 
#  geom_hline(aes(yintercept = c(0.01, 0.0001)), linetype = 2) + 
  facet_grid(~org1, scale = "free_x") + scale_y_log10() +   
  theme_bw() +
  theme(axis.text.x=element_text(angle=-90)) +
  labs(x = "Contaminant", fill = "Read Size (bp)", 
       y = "Limit of Detection",
       title = "Species Matches to Contaminat Genome (does not include exact matches)")
```
Observations: For a number of combinations the limit of detection is lower for 75 bp compared to 250 bp simulated datasets.  Need to look into the data to make sure this is not due to a bug in the code.

### Quantitaive analysis
Comparison of final guess values with proportions for exact matches only
```{r fig.width=12, fig.height=12}
sim_exact <- ddply(sim_matches[sim_matches$org2_match == "exact",], .(org1,org2,prop1, prop2, size), summarize, est_prop = sum(Final.Guess))
ggplot(sim_exact) + geom_line(aes(x = prop2, y = est_prop, color = as.character(size))) + facet_grid(org1~org2) +
  theme_bw() + 
  theme(axis.text.x=element_text(angle=-90))
```

#Need to figure out a better way to present these resutls
